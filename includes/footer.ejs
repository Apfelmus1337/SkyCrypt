<script src="https://unpkg.com/popper.js@1"></script>
<script src="https://unpkg.com/tippy.js@5"></script>
<script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
<script src="/resources/js/sticky.min.js"></script>
<script src="/resources/js/anime.min.js"></script>
<script src="/resources/js/skinview3d.bundle.js"></script>
<script src="/resources/js/modernizr.js"></script>
<script src="/resources/js/elevator.min.js"></script>

<script>
    function toggleInfo(){
        let infoBox = document.querySelector('#info_box');

        if(infoBox.classList.contains('info-opened'))
            infoBox.classList.remove('info-opened')
        else
            infoBox.classList.add('info-opened');
    }

    function togglePacks(){
        let infoBox = document.querySelector('#packs_box');

        if(infoBox.classList.contains('packs-opened'))
            infoBox.classList.remove('packs-opened')
        else
            infoBox.classList.add('packs-opened');
    }

    function switchPack(pack = false){
        console.log(pack)
        let baseURL = window.location.protocol + "//" + window.location.host + "/" + window.location.pathname.split('/')[1] + "/" + window.location.pathname.split('/')[2] + "/" + window.location.pathname.split('/')[3]
        if(pack){
            window.location.replace(`${baseURL}?pack=${pack}`);
        }else{
            window.location.replace(baseURL);
        }
    }

    Modernizr.on('webp', function(result){
        if(!Modernizr.webp.lossless){
            [].forEach.call(document.querySelectorAll('.item-icon'), function(element){
                document.documentElement.classList.add('no-webp');
            });

            [].forEach.call(document.querySelectorAll('.sea-creature-image'), function(element){
                element.style.backgroundImage = element.style.backgroundImage.replace(".webp", ".png");
            });
        }
    });

    if(!Modernizr.testAllProps('clip-path', 'ellipse(10px 10px at 10px 10px)'))
        document.documentElement.classList.add('no-clip-path');

    if(!Modernizr.testAllProps('transform', 'translateY(10px)'))
        document.documentElement.classList.add('no-transform');

    tippy('*[data-tippy-content]');

    const prideFlag = document.querySelector('.pride-flag');
    const prideFlags = ["rainbow", "trans", "lesbian", "bi", "pan", "nb", "ace", "genderfluid", "logo"];

    let currentFlag = prideFlags.length - 1;

    if(localStorage.getItem('currentFlag')){
        currentFlag = parseInt(localStorage.getItem('currentFlag'));
        prideFlag.className = 'pride-flag ' + prideFlags[currentFlag];
    }

    prideFlag.addEventListener('click', function(){
        currentFlag++;

        if(currentFlag > prideFlags.length - 1)
            currentFlag = 0;

        localStorage.setItem('currentFlag', currentFlag);
        prideFlag.className = 'pride-flag ' + prideFlags[currentFlag];
    });

    const themes = {
        "default": {
            name: "Default Theme",
            author: "SkyCrypt Team",
            colors: {
                icon: "#0BCA51",
                line: "#0BDA51",
                link: "#0BEA51",
                hover: "#09EF70",
                maxed: "#DD980E",
                gold: "#FDBB3C",
                skillbar: "#0BAA51",
                maxedbar: "#CE8F12"
            }
        },
        "skylea": {
            name: "Lea's Theme",
            author: "LeaPhant",
            colors: {
                icon: "#A6145D",
                line: "#A6145D",
                link: "#F94EA3",
                hover: "#F78DC2",
                maxed: "#DD980E",
                gold: "#FDBB3C",
                skillbar: "#850F4A",
                maxedbar: "#CE8F12"
            }
        }
    }

    if (!localStorage.getItem('currentTheme') || !themes[localStorage.getItem('currentTheme')])
        localStorage.setItem('currentTheme', 'default');

    if (localStorage.getItem('currentTheme') != 'default')
        loadTheme(localStorage.getItem('currentTheme'));

    function loadTheme(currentTheme) {
        if (!themes[currentTheme])
            return console.error(`${currentTheme} isn't a valid theme.`);

        let element = document.documentElement;
        let colors = themes[currentTheme].colors;

        for (color in colors) {
            let value = colors[color];

            switch (color) {
                case 'icon':
                case 'link': 
                    element.style.setProperty(`--${color}-rgb`, convertHex(value));
                default: 
                    element.style.setProperty(`--${color}-hex`, value);
            }
        }

        console.log(`Loaded theme: ${currentTheme}`);
    }
</script>
<% if(page == 'stats'){ %>
    <script src="/resources/js/stats.js?v60"></script>
<% } %>

<% if(page == 'api'){ %>
    <link rel="stylesheet" href="/resources/css/api.css?v0">
<% } %>